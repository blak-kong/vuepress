<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>柯里化 | 前端技术文档</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="手写源码系列！深入系列！">
    <link rel="preload" href="/assets/css/0.styles.65949c32.css" as="style"><link rel="preload" href="/assets/js/app.f3221676.js" as="script"><link rel="preload" href="/assets/js/2.02e5b305.js" as="script"><link rel="preload" href="/assets/js/35.6655291b.js" as="script"><link rel="prefetch" href="/assets/js/10.5ab39bad.js"><link rel="prefetch" href="/assets/js/11.34ab3f99.js"><link rel="prefetch" href="/assets/js/12.48619748.js"><link rel="prefetch" href="/assets/js/13.647b1675.js"><link rel="prefetch" href="/assets/js/14.5f9dfcd0.js"><link rel="prefetch" href="/assets/js/15.fd2c72b3.js"><link rel="prefetch" href="/assets/js/16.43d2e735.js"><link rel="prefetch" href="/assets/js/17.f1e6d245.js"><link rel="prefetch" href="/assets/js/18.75786f12.js"><link rel="prefetch" href="/assets/js/19.d6d825ec.js"><link rel="prefetch" href="/assets/js/20.07f193fb.js"><link rel="prefetch" href="/assets/js/21.7f7f7c5f.js"><link rel="prefetch" href="/assets/js/22.9d6466f6.js"><link rel="prefetch" href="/assets/js/23.fd0df2e3.js"><link rel="prefetch" href="/assets/js/24.0e831d19.js"><link rel="prefetch" href="/assets/js/25.064c05fd.js"><link rel="prefetch" href="/assets/js/26.ac2883e8.js"><link rel="prefetch" href="/assets/js/27.479cd0d1.js"><link rel="prefetch" href="/assets/js/28.6b237c22.js"><link rel="prefetch" href="/assets/js/29.3e3e6957.js"><link rel="prefetch" href="/assets/js/3.6c850e2c.js"><link rel="prefetch" href="/assets/js/30.7f8ee621.js"><link rel="prefetch" href="/assets/js/31.c000973c.js"><link rel="prefetch" href="/assets/js/32.8b026430.js"><link rel="prefetch" href="/assets/js/33.1bee06aa.js"><link rel="prefetch" href="/assets/js/34.95282f8f.js"><link rel="prefetch" href="/assets/js/36.743a8065.js"><link rel="prefetch" href="/assets/js/37.80a83a9e.js"><link rel="prefetch" href="/assets/js/38.f2fdcb01.js"><link rel="prefetch" href="/assets/js/39.dc20e655.js"><link rel="prefetch" href="/assets/js/4.632174fc.js"><link rel="prefetch" href="/assets/js/40.54789943.js"><link rel="prefetch" href="/assets/js/41.e5e21835.js"><link rel="prefetch" href="/assets/js/42.1b78d0a4.js"><link rel="prefetch" href="/assets/js/43.63ae8d31.js"><link rel="prefetch" href="/assets/js/44.72a7fa31.js"><link rel="prefetch" href="/assets/js/45.b5f4938e.js"><link rel="prefetch" href="/assets/js/46.790463f8.js"><link rel="prefetch" href="/assets/js/47.11f585dd.js"><link rel="prefetch" href="/assets/js/48.7cc072c1.js"><link rel="prefetch" href="/assets/js/49.0405a1da.js"><link rel="prefetch" href="/assets/js/5.a7c985c9.js"><link rel="prefetch" href="/assets/js/50.004e1f30.js"><link rel="prefetch" href="/assets/js/51.0686bd98.js"><link rel="prefetch" href="/assets/js/52.027d60de.js"><link rel="prefetch" href="/assets/js/53.633c9fd2.js"><link rel="prefetch" href="/assets/js/6.6a1b9624.js"><link rel="prefetch" href="/assets/js/7.039f99b6.js"><link rel="prefetch" href="/assets/js/8.67a3beb1.js"><link rel="prefetch" href="/assets/js/9.ce73bc4b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.65949c32.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端技术文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="javascript" class="dropdown-title"><span class="title">javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScript运行机制/01-javascript引擎.html" class="nav-link">
  JavaScript运行机制
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/函数/01-JavaScript中的三种函数.html" class="nav-link">
  函数
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/函数式编程/01-函数式入门.html" class="nav-link">
  函数式编程
</a></li><li class="dropdown-item"><!----> <a href="/javascript/手写api/01-Promise.html" class="nav-link">
  手写api
</a></li><li class="dropdown-item"><!----> <a href="/javascript/ES6+/01-let 和 const.html" class="nav-link">
  ES6+
</a></li><li class="dropdown-item"><!----> <a href="/构建工具/01-Gulp.html" class="nav-link">
  构建工具
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="构建工具" class="dropdown-title"><span class="title">构建工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/404/404.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/404/404.html" class="nav-link">
  gulp
</a></li></ul></div></div><div class="nav-item"><a href="https://www.lzwlook.fun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="javascript" class="dropdown-title"><span class="title">javascript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/JavaScript运行机制/01-javascript引擎.html" class="nav-link">
  JavaScript运行机制
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/函数/01-JavaScript中的三种函数.html" class="nav-link">
  函数
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/函数式编程/01-函数式入门.html" class="nav-link">
  函数式编程
</a></li><li class="dropdown-item"><!----> <a href="/javascript/手写api/01-Promise.html" class="nav-link">
  手写api
</a></li><li class="dropdown-item"><!----> <a href="/javascript/ES6+/01-let 和 const.html" class="nav-link">
  ES6+
</a></li><li class="dropdown-item"><!----> <a href="/构建工具/01-Gulp.html" class="nav-link">
  构建工具
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="构建工具" class="dropdown-title"><span class="title">构建工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/404/404.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/404/404.html" class="nav-link">
  gulp
</a></li></ul></div></div><div class="nav-item"><a href="https://www.lzwlook.fun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>函数式编程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaScript/函数式编程/01-函数式入门.html" class="sidebar-link">什么是函数式编程</a></li><li><a href="/JavaScript/函数式编程/02-高阶函数.html" class="sidebar-link">高阶函数</a></li><li><a href="/JavaScript/函数式编程/03-偏函数.html" class="sidebar-link">偏函数</a></li><li><a href="/JavaScript/函数式编程/04-柯里化.html" class="active sidebar-link">柯里化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript/函数式编程/04-柯里化.html#只要一个实参" class="sidebar-link">只要一个实参</a></li><li class="sidebar-sub-header"><a href="/JavaScript/函数式编程/04-柯里化.html#传一个返回一个" class="sidebar-link">传一个返回一个</a></li><li class="sidebar-sub-header"><a href="/JavaScript/函数式编程/04-柯里化.html#恒定参数" class="sidebar-link">恒定参数</a></li><li class="sidebar-sub-header"><a href="/JavaScript/函数式编程/04-柯里化.html#扩展在参数中的妙用" class="sidebar-link">扩展在参数中的妙用</a></li><li class="sidebar-sub-header"><a href="/JavaScript/函数式编程/04-柯里化.html#不需要顺序的柯里化和偏应用" class="sidebar-link">不需要顺序的柯里化和偏应用</a></li><li class="sidebar-sub-header"><a href="/JavaScript/函数式编程/04-柯里化.html#无形参风格" class="sidebar-link">无形参风格</a></li><li class="sidebar-sub-header"><a href="/JavaScript/函数式编程/04-柯里化.html#not-函数" class="sidebar-link">not 函数</a></li><li class="sidebar-sub-header"><a href="/JavaScript/函数式编程/04-柯里化.html#when-函数" class="sidebar-link">when 函数</a></li><li class="sidebar-sub-header"><a href="/JavaScript/函数式编程/04-柯里化.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/JavaScript/函数式编程/05-组合函数.html" class="sidebar-link">组合函数</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="只要一个实参"><a href="#只要一个实参" class="header-anchor">#</a> 只要一个实参</h2> <h3 id="unary-函数"><a href="#unary-函数" class="header-anchor">#</a> unary 函数</h3> <p>先来看一个奇怪的例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// example1</span>
<span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>parseFloat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [1,2,3]</span>

<span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>parseInt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [1,NaN,NaN]</span>
</code></pre></div><p>在上面的例子中，我想要将一组字符串全部设置成数字类型，但是在调用<code>parseInt</code>的时候，却出现了这样怪异的事情。这是为什么呢？</p> <p>首先我们来说一下<code>parseInt(str,radix)</code>这个函数，它接受两个参数，第一个是要被解析的字符串，第二个为可选参数，表示要解析的数字的基数。该值介于 2 ~ 36 之间,比如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//返回 10</span>
<span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;19&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//返回 19 (10+9)</span>
<span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;11&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//返回 3 (2+1)</span>
</code></pre></div><ul><li>当参数 <em>radix</em> 的值为 0，或没有设置该参数时，parseInt() 会根据 <em>string</em> 来判断数字的基数。</li> <li>如果该参数小于 2 或者大于 36，则 parseInt() 将返回 NaN。</li></ul> <p>而在案例 1 中，由于我们在调用<code>map</code>的时候，函数时会传入三个实参：<code>value</code>、<code>index</code> 和 <code>list</code>。<code>parseInt()</code>又会接收 2 个参数，所以每次都相当于是将<code>value</code>和<code>index</code>传入进去了。这样就造成后面 2 个<code>NaN</code>的情况。</p> <p>根据上面，我们可以看到，在实际开发中，我们会面临这样一个问题：在设计一个实用函数传入一个函数，而这个实用函数会把多个实参传入函数，但可能你只希望你的函数接收单一实参。如上面的<code>parseInt()</code>函数，我在调用它的时候希望它每次只接收一个参数。</p> <p>根据上面的需要，我们是不是可以来实现这么一个简单的实用函数，它包装一个函数调用，让这个函数在每次调用的时候只接收一个参数：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">unary</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">onlyOneArg</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ES6</span>
<span class="token keyword">var</span> <span class="token function-variable function">unary</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>很简单的一层封装，也很好理解。</p> <p>现在我们用它来配合上面的案例 1:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>parseFloat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [1,2,3]</span>

<span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>parseInt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [1,NaN,NaN]</span>

<span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">unary</span><span class="token punctuation">(</span>parseInt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [1,2,3]</span>
</code></pre></div><h4 id="sum-案例"><a href="#sum-案例" class="header-anchor">#</a> sum 案例</h4> <p>了解了上面的<code>unary</code>函数之后，我们来看一个复杂一些的案例。还是用<code>map</code>函数来进行举例，不过要用到我们在第二章讲到的松散型柯里化<code>looseCurry</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">looseCurry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> arity <span class="token operator">=</span> fn<span class="token punctuation">.</span>length</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 松散型柯里化</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">nextCurried</span><span class="token punctuation">(</span><span class="token parameter">prevArgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">curried</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>nextArgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> args <span class="token operator">=</span> prevArgs<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>nextArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> arity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">nextCurried</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> adder <span class="token operator">=</span> <span class="token function">looseCurry</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第一步 传2表示至少接收2个参数才可以</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr2 <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">adder</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第二步</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 生成的结果很有意思</span>
<span class="token comment">// [&quot;41,2,3,4,5&quot;, &quot;61,2,3,4,5&quot;, &quot;81,2,3,4,5&quot;, &quot;101, ...</span>
</code></pre></div><p>大家可以先将这段代码在本地跑一下，并思考为什么会出现这样的情况？🤔</p> <p>其实原理很简单：</p> <p>在第一步的时候，创建<code>adder</code>函数，只有在接收 2 个及以上参数才会运行<code>sum()</code>，</p> <p>第二步的时候，由于<code>map()</code>会传入 3 个实参：分别是<code>value</code>,<code>index</code>和<code>list</code>，而松散型的柯里化是可以接收比预期(这里也就是 2)多的参数的。</p> <p>所以在每次执行<code>sum</code>函数的时候，实际传入的都是 3 个参数，比如<code>arr</code>执行第一次的时候：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>第一次传入：
firstArg<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>   <span class="token comment">// 调用adder()时传入的3</span>
value<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 数组第一项的值</span>
index<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 数组第一项的索引</span>
list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token comment">// 整个数组</span>
<span class="token comment">// 前面3项相加为数字4，之后数字4与数组做字符串相加</span>
<span class="token operator">=&gt;</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">0</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token operator">=&gt;</span> <span class="token string">&quot;41,2,3,4,5&quot;</span>

第二次传入
firstArg<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
value<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
index<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
</code></pre></div><p>此时，使用我们的<code>unary</code>函数就可以解决上面的问题了：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> arr2 <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">unary</span><span class="token punctuation">(</span><span class="token function">adder</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [4,5,6,7,8]</span>
</code></pre></div><h2 id="传一个返回一个"><a href="#传一个返回一个" class="header-anchor">#</a> 传一个返回一个</h2> <h3 id="identity-函数"><a href="#identity-函数" class="header-anchor">#</a> identity 函数</h3> <p>说到只传一个实参的函数，在函数式编程工具库中有另一种通用的基础函数：该函数接收一个实参，然后什么都不做，原封不动地返回实参值。</p> <div class="language- extra-class"><pre class="language-text"><code>function identity(v) {
	return v;
}

// ES6 箭头函数形式
var identity =
	v =&gt;
		v;
</code></pre></div><p>举个例子，想象一下你要用正则表达式拆分（split up）一个字符串，但输出的数组中可能包含一些空值。我们可以使用 <code>filter(..)</code> 数组方法（下文会详细说到这个方法）来筛除空值，而我们将 <code>identity(..)</code> 函数作为 <code>filter(..)</code> 的断言：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> words <span class="token operator">=</span> <span class="token string">&quot;   Now is the time for all...  &quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\s|\b/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
words<span class="token punctuation">;</span>
<span class="token comment">// [&quot;&quot;,&quot;Now&quot;,&quot;is&quot;,&quot;the&quot;,&quot;time&quot;,&quot;for&quot;,&quot;all&quot;,&quot;...&quot;,&quot;&quot;]</span>

words<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>identity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [&quot;Now&quot;,&quot;is&quot;,&quot;the&quot;,&quot;time&quot;,&quot;for&quot;,&quot;all&quot;,&quot;...&quot;]</span>
</code></pre></div><h4 id="转换函数的妙用"><a href="#转换函数的妙用" class="header-anchor">#</a> 转换函数的妙用</h4> <p>另一个使用 <code>identity(..)</code> 的示例就是将其作为替代一个转换函数（译者注：transformation，这里指的是对传入值进行修改或调整，返回新值的函数）的默认函数：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> formatFn <span class="token operator">=</span> identity</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  msg <span class="token operator">=</span> <span class="token function">formatFn</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">upper</span><span class="token punctuation">(</span><span class="token parameter">txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> txt<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">output</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">,</span> upper<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// HELLO WORLD</span>
<span class="token function">output</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello World</span>
</code></pre></div><p>上面的例子，相当于是给<code>output</code>函数一个默认的函数，若是没有传的话，则原封不动的返回传进来的<code>msg</code>。</p> <h2 id="恒定参数"><a href="#恒定参数" class="header-anchor">#</a> 恒定参数</h2> <h3 id="certain-api"><a href="#certain-api" class="header-anchor">#</a> Certain API</h3> <p>Certain API 禁止直接给方法传值，而要求我们传入一个函数，就算这个函数只是返回一个值。JS Promise 中的 <code>then(..)</code>方法就是一个 Certain API。</p> <p><code>then(..)</code>中必须要传入一个函数，而有时候我们可能不需要传入一个有实际用处的函数，而是直接返回<code>then</code>在上一步中获取到的值。</p> <p>或许你可以用<code>ES6</code>的箭头函数解决这个问题：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在第二个<code>then</code>中直接将<code>p2</code>返回。</p> <h3 id="constant-函数"><a href="#constant-函数" class="header-anchor">#</a> constant 函数</h3> <p>我们可以来构造一个实用函数来实现上面的功能：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">constant</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> v<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// or the ES6 =&gt; form</span>
<span class="token keyword">var</span> <span class="token function-variable function">constant</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">;</span>
</code></pre></div><p><code>constant</code>函数功能也很简单，返回传入的参数。</p> <p>对比：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 对比：</span>

p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token function">constant</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>两种方式都可以解决<code>Certain API</code>的问题。但是我更建议用第二种方式，该箭头函数返回了一个来自外作用域的值，这和 函数式编程的理念有些矛盾。在后面“减少副作用”中会提到该行为的不足。</p> <h2 id="扩展在参数中的妙用"><a href="#扩展在参数中的妙用" class="header-anchor">#</a> 扩展在参数中的妙用</h2> <p>在第一章中，我们提到了形参数组解构：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 1, 2, [3]</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当函数必须接收一个数组，而你却想把数组内容当成单独形参来处理的时候，这个技巧十分有用。</p> <p>然而，有的时候，你无法改变原函数的定义，但想使用形参数组解构。</p> <p>比如下面这个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">bar</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3,9undefined</span>
</code></pre></div><p>由于<code>fn</code>会将实参<code>[3, 9]</code>作为<code>x</code>传入，那么<code>y</code>就是<code>undefined</code>，所以达不到我们期望的效果。</p> <p>在这种情况下，我们可能想要改变<code>bar()</code>函数的行为，将<code>foo([3, 9])</code>改为<code>foo(…[3, 9])</code>，这样就能将 <code>3</code> 和 <code>9</code> 分别传入 <code>foo(..)</code> 函数了。</p> <p>为了调整一个函数，让它能把接收的单一数组扩展成各自独立的实参，我们可以定义一个辅助函数：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">spreadArgs</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">spreadFn</span><span class="token punctuation">(</span><span class="token parameter">argsArr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>argsArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ES6 箭头函数的形式：</span>
<span class="token keyword">var</span> <span class="token function-variable function">spreadArgs</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">argsArr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>argsArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>注意 ⚠️</strong>：</p> <p>在我参考的教材中，将这个辅助函数叫为<code>spreadArgs</code>，但一些库，比如 <a href="http://ramda.cn/" target="_blank" rel="noopener noreferrer">Ramda<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，经常把它叫做 <code>apply(..)</code>。</p> <p>现在我们可以使用 <code>spreadArgs(..)</code> 来调整 <code>foo(..)</code> 函数，使其作为一个合适的输入参数并正常地工作：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">bar</span><span class="token punctuation">(</span><span class="token function">spreadArgs</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12</span>
</code></pre></div><p>本质上，<code>spreadArgs(..)</code> 函数使我们能够定义一个借助数组 <code>return</code> 多个值的函数，不过，它让这些值仍然能分别作为其他函数的输入参数来处理。</p> <p>一个函数的输出作为另外一个函数的输入被称作组合（composition），这个在后面的章节中会详细说明。</p> <p>有了<code>spreadArgs</code>函数，同样的我们也可以定义一个与它功能相反的函数：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">gatherArgs</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">gatheredFn</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>argsArr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>argsArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ES6 箭头函数形式</span>
<span class="token keyword">var</span> <span class="token function-variable function">gatherArgs</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>argsArr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span>argsArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>在 Ramda 中，该实用函数被称作 <code>unapply(..)</code>，是与 <code>apply(..)</code> 功能相反的函数。我认为术语 “扩展（spread）” 和 “聚集（gather）” 可以把这两个函数发生的事情解释得更好一些。</p></blockquote> <h2 id="不需要顺序的柯里化和偏应用"><a href="#不需要顺序的柯里化和偏应用" class="header-anchor">#</a> 不需要顺序的柯里化和偏应用</h2> <p>在上面介绍的多形参柯里化和偏应用中，参数传递都是有一定顺序的。哪一个参数在哪一步才能传，放在第一个位置都是固定好的，要是想进行修正调整可能需要费一番功夫。</p> <p>这时候我们不得不思考有没有一种方法能让我们从修正参数顺序这件事里解脱出来呢？</p> <p>或许<strong>解构模式</strong>可以？</p> <p>在第一章节中，我们提到了命名参数解构模式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  y<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined 3</span>
</code></pre></div><p>可以看到这种解构模式就相当于是一种映射，将调用时传入的实参于函数的形参进行一个映射。</p> <p>命名实参主要的好处就是不用再纠结实参传入的顺序，因此提高了可读性。</p> <h3 id="partialprops-和-curryprops"><a href="#partialprops-和-curryprops" class="header-anchor">#</a> partialProps 和 curryProps</h3> <p>有了这样的想法，我们就可以来重新调整一下原先的柯里化<code>curry</code>和偏应用<code>partial</code>了：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">partialProps</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> presetArgsObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">partialApplied</span><span class="token punctuation">(</span><span class="token parameter">laterArgsObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> presetArgsObj<span class="token punctuation">,</span> laterArgsObj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">curryProps</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> arity <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">nextCurried</span><span class="token punctuation">(</span><span class="token parameter">prevArgsObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">curried</span><span class="token punctuation">(</span><span class="token parameter">nextArgObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>nextArgObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> allArgsObj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> prevArgsObj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">:</span> nextArgObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>allArgsObj<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> arity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>allArgsObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">nextCurried</span><span class="token punctuation">(</span>allArgsObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们甚至不需要设计一个 <code>partialPropsRight(..)</code> 函数了，因为我们根本不需要考虑属性的映射顺序，通过命名来映射形参完全解决了我们有关于顺序的烦恼！</p> <p>现在可以来试试这两个新函数：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">x:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> y:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> z:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>z<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> f1 <span class="token operator">=</span> <span class="token function">curryProps</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> f2 <span class="token operator">=</span> <span class="token function">partialProps</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token punctuation">{</span> y<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">{</span> y<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> z<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// x:1 y:2 z:3</span>

<span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">{</span> z<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> x<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// x:1 y:2 z:3</span>
</code></pre></div><p>我们不用再为参数顺序而烦恼了！现在，我们可以指定我们想传入的实参，而不用管它们的顺序如何。也不需要类似 <code>reverseArgs(..)</code> 的函数或其它妥协了。</p> <h3 id="属性扩展"><a href="#属性扩展" class="header-anchor">#</a> 属性扩展</h3> <p>上面的<code>partialProps</code> 看似解决了我们这种多形参无顺序的问题，但是，只有在我们可以掌控 <code>foo(..)</code> 的函数签名，并且可以定义该函数的行为，使其解构第一个参数的时候，以上技术才能起作用。</p> <p>如果一个函数，其形参是各自独立的（没有经过形参解构），而且不能改变它的函数签名，那我们应该如何运用这个技术呢？</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">x:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> y:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> z:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>z<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>比如上面的<code>bar</code>函数，接收的就是三个参数，但是我想要能映射到对应的位置，比如这样传：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">{</span> y<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> x<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> z<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="spreadargprops-函数"><a href="#spreadargprops-函数" class="header-anchor">#</a> spreadArgProps 函数</h4> <p>就像之前的 <code>spreadArgs(..)</code> 实用函数一样，我们也可以定义一个 <code>spreadArgProps(..)</code> 辅助函数，它接收对象实参的 <code>key: value</code> 键值对，并将其 “扩展” 成独立实参。</p> <p>为了满足上面的需求，我们现在需要取得在调用<code>fn</code>时传递的实际参数。</p> <p>在<code>JS</code>的函数对象上有一个<code>toString()</code>方法，它返回函数代码的字符串形式，其中包括函数声明的签名。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">spreadArgProps</span><span class="token punctuation">(</span>
  fn<span class="token punctuation">,</span>
  propOrder <span class="token operator">=</span> fn
    <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
      <span class="token regex">/^(?:(?:function.*\(([^]*?)\))|(?:([^\(\)]+?)\s*=&gt;)|(?:\(([^]*?)\)\s*=&gt;))[^]+$/</span><span class="token punctuation">,</span>
      <span class="token string">&quot;$1$2$3&quot;</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\s*,\s*/</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[=\s].*$/</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">spreadFn</span><span class="token punctuation">(</span><span class="token parameter">argsObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>propOrder<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">k</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> argsObj<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>让我们看看 <code>spreadArgProps(..)</code> 实用函数是怎么用的：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">x:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> y:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> z:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>z<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> f3 <span class="token operator">=</span> <span class="token function">curryProps</span><span class="token punctuation">(</span><span class="token function">spreadArgProps</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> f4 <span class="token operator">=</span> <span class="token function">partialProps</span><span class="token punctuation">(</span><span class="token function">spreadArgProps</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> y<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">f3</span><span class="token punctuation">(</span><span class="token punctuation">{</span> y<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> z<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// x:1 y:2 z:3</span>

<span class="token function">f4</span><span class="token punctuation">(</span><span class="token punctuation">{</span> z<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> x<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// x:1 y:2 z:3</span>
</code></pre></div><p>虽然上面的方法看上去有些不靠谱，但是它确实能解决我们实际的问题，至少解决了 80%的情况。</p> <h2 id="无形参风格"><a href="#无形参风格" class="header-anchor">#</a> 无形参风格</h2> <p>在函数式编程中，还有一种流行的代码风格，其目的是通过移除不必要的形参-实参映射来减少视觉上的干扰。这种风格的正式名称为 “隐性编程（tacit programming）”，一般则称作 “无形参（point-free）” 风格。术语 “point” 在这里指的是函数形参。</p> <p>我们从一个简单的例子开始：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">double</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">mapper</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">double</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [2,4,6,8,10]</span>
</code></pre></div><p>可以看到 <code>mapper(..)</code> 函数和 <code>double(..)</code> 函数有相同（或相互兼容）的函数签名。形参（也就是所谓的 “point“）<code>v</code> 可以直接映射到 <code>double(..)</code> 函数调用里相应的实参上。这样，<code>mapper(..)</code> 函数包装层是非必需的。我们可以将其简化为无形参风格：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">double</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>double<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [2,4,6,8,10]</span>
</code></pre></div><p>还有之前<code>parseInt()</code>的例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> <span class="token keyword">function</span> <span class="token function">mapper</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span> v <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [1,2,3]</span>

<span class="token operator">=&gt;</span> 无形参风格：
<span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> <span class="token function">unary</span><span class="token punctuation">(</span> parseInt <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [1,2,3]</span>
</code></pre></div><p>借助<code>unary()</code>函数使得每次只传一个参数。</p> <h2 id="not-函数"><a href="#not-函数" class="header-anchor">#</a> not 函数</h2> <p>首先来看一个案例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token parameter">txt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">printIf</span><span class="token punctuation">(</span><span class="token parameter">predicate<span class="token punctuation">,</span> msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">predicate</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">output</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">isShortEnough</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> str<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> msg1 <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> msg2 <span class="token operator">=</span> msg1 <span class="token operator">+</span> <span class="token string">&quot; World&quot;</span><span class="token punctuation">;</span>

<span class="token function">printIf</span><span class="token punctuation">(</span>isShortEnough<span class="token punctuation">,</span> msg1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello</span>
<span class="token function">printIf</span><span class="token punctuation">(</span>isShortEnough<span class="token punctuation">,</span> msg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>案例很简单，我们要求当信息足够长时，将它打印出来，换而言之，我们需要一个 <code>!isShortEnough(..)</code> 断言。你可能会首先想到：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">isLongEnough</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">isShortEnough</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">printIf</span><span class="token punctuation">(</span>isLongEnough<span class="token punctuation">,</span> msg1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printIf</span><span class="token punctuation">(</span>isLongEnough<span class="token punctuation">,</span> msg2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello World</span>
</code></pre></div><p>上面的方式看似是很简单的，但是还是需要我们传递<code>str</code>，现在我们能否不通过重新实现 <code>str.length</code> 的检查逻辑，而重构代码并使其变成无形参风格呢？</p> <p>我们定义一个 <code>not(..)</code> 取反辅助函数（在函数式编程库中又被称作 <code>complement(..)</code>）：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">not</span><span class="token punctuation">(</span><span class="token parameter">predicate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">negated</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">predicate</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ES6 箭头函数形式</span>
<span class="token keyword">var</span> <span class="token function-variable function">not</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">predicate</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token function">predicate</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>传入的<code>predicate</code>为断言，也就是条件。</p> <p>现在我们可以用<code>not</code>函数来修改上面的例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> isLongEnough <span class="token operator">=</span> <span class="token function">not</span><span class="token punctuation">(</span>isShortEnough<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printIf</span><span class="token punctuation">(</span>isLongEnough<span class="token punctuation">,</span> msg2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello World</span>
</code></pre></div><h2 id="when-函数"><a href="#when-函数" class="header-anchor">#</a> when 函数</h2> <p>到目前位置，上面的案例已经被我们优化的不错了。但是也许还能再进一步，我们实际上可以将 <code>printIf(..)</code> 函数本身重构成无形参风格。</p> <p>我们可以用 <code>when(..)</code> 实用函数来表示 <code>if</code> 条件句：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">when</span><span class="token punctuation">(</span><span class="token parameter">predicate<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">conditional</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">predicate</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ES6</span>
<span class="token keyword">var</span> <span class="token function-variable function">when</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">predicate<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">predicate</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
</code></pre></div><p>我们把本章前面讲到的另一些辅助函数和 <code>when(..)</code> 函数结合起来搞定无形参风格的 <code>printIf(..)</code> 函数：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> printIf <span class="token operator">=</span> <span class="token function">uncurry</span><span class="token punctuation">(</span><span class="token function">partialRight</span><span class="token punctuation">(</span>when<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>我们是这么做的：将 <code>output</code> 方法右偏应用为 <code>when(..)</code> 函数的第二个（<code>fn</code> 形参）实参，这样我们得到了一个仍然期望接收第一个实参（<code>predicate</code> 形参）的函数。当<strong>该函数</strong>被调用时，会产生另一个期望接收（译者注：需要被打印的）信息字符串的函数，看起来就是这样：<code>fn(predicate)(str)</code>。</p> <p>多个（两个）链式函数的调用看起来很挫，就像被柯里化的函数。于是我们用 <code>uncurry(..)</code> 函数处理它，得到一个期望接收 <code>str</code> 和 <code>predicate</code> 两个实参的函数，这样该函数的签名就和 <code>printIf(predicate,str)</code> 原函数一样了。</p></blockquote> <h3 id="printif-案例"><a href="#printif-案例" class="header-anchor">#</a> printIf 案例</h3> <p>现在我们可以将上面的<code>printIf</code>整理一下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">isShortEnough</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> str<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> isLongEnough <span class="token operator">=</span> <span class="token function">not</span><span class="token punctuation">(</span>isShortEnough<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> printIf <span class="token operator">=</span> <span class="token function">uncurry</span><span class="token punctuation">(</span><span class="token function">partialRight</span><span class="token punctuation">(</span>when<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> msg1 <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> msg2 <span class="token operator">=</span> msg1 <span class="token operator">+</span> <span class="token string">&quot; World&quot;</span><span class="token punctuation">;</span>

<span class="token function">printIf</span><span class="token punctuation">(</span>isShortEnough<span class="token punctuation">,</span> msg1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello</span>
<span class="token function">printIf</span><span class="token punctuation">(</span>isShortEnough<span class="token punctuation">,</span> msg2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printIf</span><span class="token punctuation">(</span>isLongEnough<span class="token punctuation">,</span> msg1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printIf</span><span class="token punctuation">(</span>isLongEnough<span class="token punctuation">,</span> msg2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello World</span>
</code></pre></div><h3 id="list-案例"><a href="#list-案例" class="header-anchor">#</a> list 案例</h3> <p>实现功能：</p> <p>若是列表中的数大于 3 则添加进<code>greater</code>，否则添加进<code>less</code>。</p> <p>这种简单的案例虽然可以用十分简单的方式来实现，但是为了习惯函数式编程的写法，所以算是我做一个小练习吧。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> greater <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> less <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">isGreater</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">pushGreater</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> greater<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">pushLess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> less<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">handleFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">uncurry</span><span class="token punctuation">(</span><span class="token function">partialRight</span><span class="token punctuation">(</span>when<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> setGreater <span class="token operator">=</span> <span class="token function">handleFn</span><span class="token punctuation">(</span>pushGreater<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> setLess <span class="token operator">=</span> <span class="token function">handleFn</span><span class="token punctuation">(</span>pushLess<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">handleList</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setGreater</span><span class="token punctuation">(</span>isGreater<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setLess</span><span class="token punctuation">(</span><span class="token function">not</span><span class="token punctuation">(</span>isGreater<span class="token punctuation">)</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;greater&quot;</span><span class="token punctuation">,</span> greater<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;less&quot;</span><span class="token punctuation">,</span> less<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">handleList</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// greater [4, 5]</span>
<span class="token comment">// less [1, 2, 3]</span>
</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <blockquote><p>偏应用是用来减少函数的参数数量 —— 一个函数期望接收的实参数量 —— 的技术，它减少参数数量的方式是创建一个预设了部分实参的新函数。</p> <p>柯里化是偏应用的一种特殊形式，其参数数量降低为 1，这种形式包含一串连续的链式函数调用，每个调用接收一个实参。当这些链式调用指定了所有实参时，原函数就会拿到收集好的实参并执行。你同样可以将柯里化还原。</p> <p>其它类似 <code>unary(..)</code>、<code>identity(..)</code> 以及 <code>constant(..)</code> 的重要函数操作，是函数式编程基础工具库的一部分。</p> <p>无形参是一种书写代码的风格，这种风格移除了非必需的形参映射实参逻辑，其目的在于提高代码的可读性和可理解性。</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/JavaScript/函数式编程/03-偏函数.html" class="prev">
        偏函数
      </a></span> <span class="next"><a href="/JavaScript/函数式编程/05-组合函数.html">
        组合函数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f3221676.js" defer></script><script src="/assets/js/2.02e5b305.js" defer></script><script src="/assets/js/35.6655291b.js" defer></script>
  </body>
</html>
